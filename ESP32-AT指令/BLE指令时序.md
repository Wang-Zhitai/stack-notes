## 1. BLE服务器通信步骤

```c
/* 关闭回显，收到两次响应 */
ATE0\r\n
ATE0

OK

/* 初始化BLE服务器，响应OK */
AT+BLEINIT=2\r\n

OK

/* 初始化BLE广播名，响应OK */
AT+BLEADVDATAEX="DN100B","A002","446559696E54656368",1\r\n

OK

/* 创建GATT服务，响应OK */
AT+BLEGATTSSRVCRE\r\n

OK

/* 广播BLE地址，响应OK */
AT+BLEADVSTART\r\n

OK

/* 打开GATT服务，响应OK */
AT+BLEGATTSSRVSTART\r\n

OK
 
/* 初始化透传参数，响应OK */
AT+BLESPPCFG=1,1,6,1,5,1\r\n

OK
    
/* 等待连接响应。缺一不可 */
+BLECONN:0,"78:42:1c:2d:29:de"
+WRITE:0,1,6,1,2,

/* 连接成功后发送指令进入透传模式，响应OK和> */
AT+BLESPP\r\n

OK

>
    
/* 透传模式下和串口操作没有区别，正常收发即可 */
TEST//发送数据
ABCDEABCDEABCDEABCDEABCDEABCDEABCDEABCDE//接收数据   
```

## 2. BLE客户端通信步骤

~~~ C
/* 关闭回显，收到两次响应 */
ATE0\r\n
ATE0

OK

/* 初始化BLE客户端，响应OK */
AT+BLEINIT=1\r\n

OK

/* 按照蓝牙名搜索服务端，响应OK和信号列表 */
AT+BLESCAN=1,2,2,"DN100B"\r\n

OK
+BLESCAN:"78:42:1c:2e:c4:1a",-15,0201060709444e313030420303a0020aff446559696e54656368020a03,,0
+BLESCAN:"78:42:1c:2e:c4:1a",-11,0201060709444e313030420303a0020aff446559696e54656368020a03,,0
+BLESCAN:"78:42:1c:2e:c4:1a",-16,0201060709444e313030420303a0020aff446559696e54656368020a03,,0
+BLESCAN:"78:42:1c:2e:c4:1a",-11,0201060709444e313030420303a0020aff446559696e54656368020a03,,0
+BLESCAN:"78:42:1c:2e:c4:1a",-16,0201060709444e313030420303a0020aff446559696e54656368020a03,,0
+BLESCAN:"78:42:1c:2e:c4:1a",-15,0201060709444e313030420303a0020aff446559696e54656368020a03,,0
+BLESCAN:"78:42:1c:2e:c4:1a",-11,0201060709444e313030420303a0020aff446559696e54656368020a03,,0
+BLESCAN:"78:42:1c:2e:c4:1a",-16,0201060709444e313030420303a0020aff446559696e54656368020a03,,0
+BLESCAN:"78:42:1c:2e:c4:1a",-15,0201060709444e313030420303a0020aff446559696e54656368020a03,,0
+BLESCAN:"78:42:1c:2e:c4:1a",-15,0201060709444e313030420303a0020aff446559696e54656368020a03,,0
+BLESCAN:"78:42:1c:2e:c4:1a",-16,0201060709444e313030420303a0020aff446559696e54656368020a03,,0
+BLESCAN:"78:42:1c:2e:c4:1a",-15,0201060709444e313030420303a0020aff446559696e54656368020a03,,0
+BLESCAN:"78:42:1c:2e:c4:1a",-16,0201060709444e313030420303a0020aff446559696e54656368020a03,,0
+BLESCANDONE

/* 根据MAC地址连接服务端，响应+BLECONN: */
AT+BLECONN=0,"78:42:1c:2e:c4:1a",0,10\r\n
+BLESCANDONE
+BLECONN:0,"78:42:1c:2e:c4:1a"

OK

/* 发现服务端提供的GATT服务，响应OK */
AT+BLEGATTCPRIMSRV=0\r\n
+BLEGATTCPRIMSRV:0,1,0x1801,1
+BLEGATTCPRIMSRV:0,2,0x1800,1
+BLEGATTCPRIMSRV:0,3,0xA002,1
+BLEGATTCPRIMSRV:0,4,0xA003,1

OK
    
/* 给GATT服务赋值，通知服务器开启接收透传模式，响应>和OK */
AT+BLEGATTCWR=0,3,6,1,4\r\n
>
0100

OK

/* 客户端接收数据,一次只能收到20个字节会将超出的部分拆分发过来，此处的20就是接收到的有效数据载荷是20字节 */
+INDICATE:0,3,6,20,	\r\n 
+INDICATE:0,3,6,3,\r\n

/* 客户端向服务端发送数据，一次最多1024字节,此处的1024就是要发送的字节数，发送成功响应OK */
AT+BLEGATTCWR=0,3,5,1024\r\n
>
//1024个字节的数据//
OK
    
/* 服务端掉线，客户端会收到此消息 */ 
+BLEDISCONN:0,"78:42:1c:2e:c4:1a"
~~~
